<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>My Backbone Tutorials</title>
        <link href="../../_assets/main/css/normalize.css" rel="stylesheet" />
        <link href="../../_assets/main/css/main.css" rel="stylesheet" />
    </head>
    <body>
        <!-- user template -->
        <script type="text/template" id="userTemp">
            <div>
                <label>ID         </label> :    <strong><%= ID %>         </strong>
                <label>User Name  </label> :    <strong><%= UserName %>   </strong>
                <label>Full Name  </label> :    <strong><%= FullName %>   </strong>
                <label>Pasword    </label> :    <strong><%= Password %>   </strong>    
                <label>E-posta    </label> :    <strong><%= Eposta %>     </strong>    
            </div>
        </script>
        
        <!-- post template -->
        <script type="text/template" id="postTemp">
            <div>
                <label>ID            </label> :           <strong><%= ID %>         </strong>
                <label>Title         </label> :           <strong><%= Title %>      </strong>
                <label>Content       </label> :           <strong><%= Content %>    </strong>
                <label>Date          </label> :           <strong><%= Date %>       </strong>    
                <label>UserID        </label> :           <strong><%= UserID %>     </strong>    
            </div>
        </script>
            
        <script src="../../_assets/main/js/libs/jquery-1.11.2.js"></script>
        <script src="../../_assets/main/js/libs/underscore.js"></script>
        <script src="../../_assets/main/js/libs/backbone.js"></script>
        
        <strong>USERS</strong><br><br>
        <div id="users"></div>
        
        <br><br><br>
        <strong>POST</strong>
        <br><br>
        <div id="posts"></div>
        <br><br>
        <div id="result"></div>
        
        
        <script type="text/javascript">
            /* user model */
            var User = Backbone.Model.extend({
                defaults: {
                	"ID": 0,
                	"UserName": "",
                	"FullName": "",
                	"Password": "",
                	"Eposta": ""
                },
                initialize: function(){
                    //console.log("User Model is Init");
                }
            });
            
            /* post model */
            var Post = Backbone.Model.extend({
                defaults: {
                	"ID": 0,
                	"Title": "",
                	"Content": "",
                	"Date": "",
                	"UserID": 0
                },
                initialize: function(){
                    //console.log("Post Model is Init");
                }
            });
            
            /* users collection */
            var Users = Backbone.Collection.extend({
                Model: User,
                initialize: function(){
                    //console.log("Users Collecton is Init");
                }
            });
            
            /* posts collection */
            var Posts = Backbone.Collection.extend({
                Model: Post,
                initialize: function(){
                    //console.log("Posts Collection is Init");
                }
            });
            
            /* user view */
            var UserItemView = Backbone.View.extend({
                template: _.template( $("#userTemp").html()),
                initialize: function(){
                    //console.log("UserView is init");
                    //this.render();
                },
                render: function(){
                    this.$el.html( this.template(this.model.toJSON()) );
                    return this;
                }
            });
            
            /* post view */
            var PostItemView = Backbone.View.extend({
                template: _.template( $("#postTemp").html() ),
                initialize: function(){
                    //console.log("PostView is init");
                    //this.render();
                },
                render: function(){
                    this.$el.html( this.template(this.model.toJSON()) );
                    return this;
                }
            });
            
            
            /* Collection view */
            
            /* UserCollectionView */
            var UserCollectionView = Backbone.View.extend({
                initialize: function(){
                    this.renderAll();
                },
                render: function(model){
                    var userItemView = new UserItemView({ model: model });
                    this.$el.append( userItemView.render().el );
                },
                renderAll: function(){
                    var _this = this;
                    
                    _.each(this.collection.models, function(model){
                        _this.render(model);
                    });
                    
                }
            });
            
            
            /* Post Collecton View */
            var PostCollectionView = Backbone.View.extend({
                initialize: function(){
                    this.renderAll();
                },
                render: function( model ){
                    var postItemView = new PostItemView({ model: post });
                    this.$el.append( postItemView.render().el )
                },
                renderAll: function(){
                    var _this = this;
                    
                    _.each(this.collection.models, function(model){
                        _this.render(model);
                    });
                }
            });
            
            
            
            
            /* -------------------------------------------------------------***/
            
            /* model */
            var user = new User({ 
                ID: 5,
                UserName: "test", 
                FullName: "test", 
                Password: "şifrem", 
                Eposta: "epostam"
            });
            
            var user2 = new User({ 
                ID: 2,
                UserName: "test2", 
                FullName: "test2", 
                Password: "şifrem2", 
                Eposta: "epostam2"
            });
            
            var post = new Post({
                ID: 3,
                Title: "title test",
                Content: "title content",
                Date: "12.12.12",
                UserID: 2
            });
            
            var post2 = new Post({
                ID: 2,
                Title: "title test2",
                Content: "title content2",
                Date: "24.05.12",
                UserID: 5
            });
            
            /* collection */
            var users = new Users([ user, user2 ]);
            var posts = new Posts([ post, post2 ]);
           
            
            /* Collection View */
            var userCollectionView = new UserCollectionView({ el: $("#users"), collection: users });
            var postCollectionView = new PostCollectionView({ el: $("#posts"), collection: posts });
            
            
        </script>
    </body>
</html>